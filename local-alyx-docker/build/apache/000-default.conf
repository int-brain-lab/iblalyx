Listen %ALYX_PORT%

<VirtualHost *:%ALYX_PORT%>

    LogLevel info
    ServerName %ALYX_NETWORK%
    ServerAlias 127.0.0.1 localhost ${HOSTNAME}
    ServerAdmin webmaster@internationalbrainlab.org
    DocumentRoot /var/www/alyx-%ALYX_INSTANCE%

    <Directory /var/www/alyx-%ALYX_INSTANCE%/alyx/alyx>
        <Files wsgi.py>
            Require all granted
        </Files>
        Include /etc/apache2/sites-available/ip_whitelist.conf
    </Directory>

    Alias /static/ /var/www/alyx-%ALYX_INSTANCE%/alyx/static/
    Alias /media/ /var/www/alyx-%ALYX_INSTANCE%/alyx/media/

    <Directory /var/www/alyx-%ALYX_INSTANCE%/alyx/static>
        Require all granted
    </Directory>

    <Directory /var/www/alyx-%ALYX_INSTANCE%/alyx/media>
        Require all granted
    </Directory>

    ErrorLog ${APACHE_LOG_DIR}/error_alyx.log
    CustomLog ${APACHE_LOG_DIR}/access_alyx.log combined

    WSGIApplicationGroup %{GLOBAL}
    WSGIProcessGroup %ALYX_NETWORK%
    WSGIScriptAlias / /var/www/alyx-%ALYX_INSTANCE%/alyx/alyx/wsgi.py
    WSGIDaemonProcess %ALYX_NETWORK% home=/var/www/alyx-%ALYX_INSTANCE% user=%PGUSER% group=docker python-home=/usr/local python-path=/usr/local/lib/python3.9/site-packages:/usr/local/bin:/var/www/alyx-%ALYX_INSTANCE%/alyx listen-backlog=50 socket-user=#33
    WSGIPassAuthorization On

    # Configurations for easy maintenance mode
    RewriteEngine On
    RewriteCond %{ENV:REDIRECT_STATUS} !=503
    RewriteCond "/var/www/alyx-%ALYX_INSTANCE%/maintenance.trigger" -f
    RewriteRule ^(.*)$ /$1 [R=503,L]

</VirtualHost>
